# ДЗ3

## Сущность
В качестве "основной сущности" нашего приложения мы выбрали пины. В рамках этого тестирования мы загружаем картинку и заполняем данными поля заголовка и описания пина.

## Подготовка 
Для проведения нагрузочного тестирования был выбран инструмент [wrk](https://github.com/wg/wrk).
Установка wrk на macOS происходит с помощью следующей команды: 
```
brew install wrk
```

### Тестирование POST API Endpoint'а
Запускается с помощью bash-скрипта `post_wrk_test.sh`, который выполняет следующие действия:
 - получает csrf-токен
 - подставляет csrf-токен в запрос на авторизацию, производит ее и  получает session-токен
 - запускает тестирование

Подробнее разберем команду запуска:
```
wrk -t6 -c6 -d150m https://harmoniums.ru \
    -H "X-CSRF-Token: ${csrf_token}" \
    -H "Cookie: _gorilla_csrf=${gorilla_csrf}; session_token=${session_token}" \
    -s ./post_wrk_test.lua
```
Параметры тестирования: 6 потоков, 6 HTTP-соединений, длительность - 150 минут. 
Данные запроса формируются Lua-скриптом `post_wrk_test.lua`, который включает в тело запроса изображение и данные о пине.

### Тестирование GET API Endpoint'а
Запускается с помощью bash-скрипта `post_wrk_test.sh`. В данном случае авторизация уже не нужна.

Команда запуска (содержится внтури `post_wrk_test.sh`):
```
wrk -t6 -c6 ?
```
Данные запроса формируются Lua-скриптом `get_wrk_test.lua`.

## Создание сущности
Перейдем в директорию `perf_test`, где хранится все необходимое для запуска тестирования.
Сделаем файл `post_wrk_test.sh` исполняемым с помощью команды:
```
chmod +x ./post_wrk_test.sh
```
И затем запустим его:
```
chmod +x ./post_wrk_test.sh
```
[//]: # (Сюда вставляем вывод команды)

## Чтение сущности
Повторим действия, описанные выше, с файлами `get_wrk_test.sh` и `get_wrk_test.lua` соответственно.

[//]: # (Сюда тоже тесты)

## Улучшения 

Для улучшения результатов можно: 
 - подумать над оптимизацией столбцов в таблице - убрать лишние столбцы, которые не используются в текущей логике программы (`click_url`).  
 - оптимизировать данные в столбцах; к примеру, не хранить ссылку на фото целиком, а хранить только ту часть, которая изменяется.
 - ускорить сортировку и поиск данных, добавив индекс по столбцам `created_at` и `author_id`.
